<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Scheduler</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2rem;
            color: #fff;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 0.9rem;
        }

        .week-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .week-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .week-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .week-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #3b82f6;
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.4);
        }

        .week-btn-label {
            font-weight: 600;
        }

        .week-btn-dates {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .dashboard {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px 30px;
            text-align: center;
            min-width: 120px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .stat-card.best {
            border-color: #4ade80;
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.3);
        }

        .stat-card.worst {
            border-color: #f87171;
            box-shadow: 0 0 20px rgba(248, 113, 113, 0.3);
        }

        .stat-day {
            font-size: 0.85rem;
            color: #aaa;
            margin-bottom: 5px;
        }

        .stat-count {
            font-size: 2rem;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #888;
        }

        .container {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .people-pool {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .people-pool h2 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .people-pool h2::before {
            content: 'üë•';
        }

        .people-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 200px;
        }

        .person {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            padding: 12px 15px;
            border-radius: 10px;
            cursor: grab;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
        }

        .person:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.4);
        }

        .person:active {
            cursor: grabbing;
        }

        .person.dragging {
            opacity: 0.5;
            transform: scale(1.05);
        }

        .person-avatar {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .person-name {
            flex: 1;
            font-size: 0.9rem;
        }

        .person-wfh-days {
            display: flex;
            gap: 3px;
        }

        .wfh-dot {
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
        }

        .wfh-dot.filled {
            background: #fbbf24;
        }

        .schedule {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
        }

        .day-column {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .day-column.drag-over {
            border-color: #4ade80;
            box-shadow: 0 0 30px rgba(74, 222, 128, 0.3);
        }

        .day-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .day-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .day-count {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .day-count.high {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
        }

        .day-count.low {
            background: rgba(248, 113, 113, 0.2);
            color: #f87171;
        }

        .wfh-zone {
            min-height: 150px;
            padding: 10px;
            border-radius: 10px;
            background: rgba(251, 191, 36, 0.1);
            border: 2px dashed rgba(251, 191, 36, 0.3);
            margin-bottom: 10px;
        }

        .wfh-zone h3 {
            font-size: 0.75rem;
            color: #fbbf24;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .wfh-zone .person {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            margin-bottom: 8px;
            padding: 8px 12px;
        }

        .wfh-zone .person:hover {
            box-shadow: 0 5px 20px rgba(245, 158, 11, 0.4);
        }

        .wfh-zone .person-avatar {
            width: 28px;
            height: 28px;
            font-size: 0.7rem;
        }

        .wfh-zone .person-name {
            font-size: 0.8rem;
        }

        .in-office-list {
            min-height: 100px;
        }

        .in-office-list h3 {
            font-size: 0.75rem;
            color: #4ade80;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .office-person {
            background: rgba(74, 222, 128, 0.1);
            padding: 6px 10px;
            border-radius: 6px;
            margin-bottom: 4px;
            font-size: 0.8rem;
            color: #4ade80;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .office-person::before {
            content: 'üè¢';
            font-size: 0.7rem;
        }

        .leave-zone {
            min-height: 80px;
            padding: 10px;
            border-radius: 10px;
            background: rgba(168, 85, 247, 0.1);
            border: 2px dashed rgba(168, 85, 247, 0.3);
            margin-top: 10px;
        }

        .leave-zone h3 {
            font-size: 0.75rem;
            color: #a855f7;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .leave-zone .person {
            background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
            margin-bottom: 8px;
            padding: 8px 12px;
        }

        .leave-zone .person:hover {
            box-shadow: 0 5px 20px rgba(168, 85, 247, 0.4);
        }

        .leave-zone .person-avatar {
            width: 28px;
            height: 28px;
            font-size: 0.7rem;
        }

        .leave-zone .person-name {
            font-size: 0.8rem;
        }

        .day-column.drag-over-leave {
            border-color: #a855f7;
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.3);
        }

        .instructions {
            text-align: center;
            padding: 20px;
            color: #888;
            font-size: 0.85rem;
            margin-top: 20px;
        }

        .error-msg {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #ef4444;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .error-msg.show {
            opacity: 1;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }

            .schedule {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .schedule {
                grid-template-columns: repeat(2, 1fr);
            }

            .dashboard {
                gap: 10px;
            }

            .stat-card {
                padding: 15px 20px;
                min-width: 100px;
            }
        }

        @media (max-width: 500px) {
            .schedule {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>Team Scheduler</h1><br><br>

    <div class="week-selector" id="week-selector"></div>

    <div class="dashboard" id="dashboard"></div>

    <div class="container">
        <div class="people-pool">
            <h2>Team Members</h2>
            <div class="people-list" id="people-pool"></div>
        </div>

        <div class="schedule" id="schedule"></div>
    </div>

    

    <div class="error-msg" id="error-msg"></div>

    <script>
        const people = [
            "Anne Sorbello",
            "Ben Carpenter",
            "Carlos V. Mendoza",
            "Elizaveta Govorukhina",
            "Javier Zapien",
            "Kariman Abouelkheir",
            "Kirsten Collins",
            "Lorenzo Marri",
            "Maddie Grant",
            "Malak Elzahed",
            "Mostafa Aref",
            "Romeo Perez",
            "Sajida Elrayih",
            "Sarah Beatty",
            "Stefany Carballo",
            "Talal Tariq",
            "Tom Price",
            "Will Cameron",
            "Yamen Albadin"
        ];

        const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"];

        // Current selected week (0 = this week, 1 = next week)
        let selectedWeek = 0;

        // State: weekKey -> { wfh: { person -> days[] }, leave: { person -> days[] } }
        let allSchedules = {};

        // Get current week's schedule - ensures the week exists in allSchedules
        function ensureWeekExists(weekOffset = selectedWeek) {
            const weekKey = getWeekKey(weekOffset);
            if (!allSchedules[weekKey]) {
                allSchedules[weekKey] = { wfh: {}, leave: {} };
            }
            return weekKey;
        }

        // Helper to get current wfh/leave schedules
        function getCurrentSchedules() {
            const weekKey = ensureWeekExists();
            return {
                wfh: allSchedules[weekKey].wfh,
                leave: allSchedules[weekKey].leave
            };
        }

        // Calculate the Monday of a given week offset (0 = this week, 1 = next week)
        function getWeekMonday(weekOffset = 0) {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // Adjust for Sunday
            const monday = new Date(today);
            monday.setDate(today.getDate() + diff + (weekOffset * 7));
            monday.setHours(0, 0, 0, 0);
            return monday;
        }

        // Get a unique key for a week (YYYY-MM-DD of Monday)
        function getWeekKey(weekOffset = 0) {
            const monday = getWeekMonday(weekOffset);
            return monday.toISOString().split('T')[0];
        }

        // Format date range for display
        function getWeekDateRange(weekOffset = 0) {
            const monday = getWeekMonday(weekOffset);
            const friday = new Date(monday);
            friday.setDate(monday.getDate() + 4);

            const formatDate = (d) => {
                const day = d.getDate();
                const month = d.toLocaleDateString('en-US', { month: 'short' });
                return `${day} ${month}`;
            };

            return `${formatDate(monday)} - ${formatDate(friday)}`;
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').substring(0, 2);
        }

        function getPersonId(name) {
            return name.toLowerCase().replace(/[^a-z]/g, '');
        }

        function createPersonElement(name, inWfhZone = false) {
            const person = document.createElement('div');
            person.className = 'person';
            person.draggable = true;
            person.dataset.name = name;

            const { wfh: wfhSchedule } = getCurrentSchedules();
            const wfhDays = wfhSchedule[name] || [];

            person.innerHTML = `
                <div class="person-avatar">${getInitials(name)}</div>
                <div class="person-name">${name}</div>
                ${!inWfhZone ? `
                <div class="person-wfh-days">
                    <div class="wfh-dot ${wfhDays.length >= 1 ? 'filled' : ''}"></div>
                    <div class="wfh-dot ${wfhDays.length >= 2 ? 'filled' : ''}"></div>
                </div>
                ` : ''}
            `;

            person.addEventListener('dragstart', handleDragStart);
            person.addEventListener('dragend', handleDragEnd);

            return person;
        }

        function showError(message) {
            const errorEl = document.getElementById('error-msg');
            errorEl.textContent = message;
            errorEl.classList.add('show');
            setTimeout(() => errorEl.classList.remove('show'), 3000);
        }

        function handleDragStart(e) {
            e.target.classList.add('dragging');
            e.dataTransfer.setData('text/plain', e.target.dataset.name);
            const wfhZone = e.target.closest('.wfh-zone');
            const leaveZone = e.target.closest('.leave-zone');
            if (wfhZone) {
                e.dataTransfer.setData('source', wfhZone.dataset.day);
                e.dataTransfer.setData('sourceType', 'wfh');
            } else if (leaveZone) {
                e.dataTransfer.setData('source', leaveZone.dataset.day);
                e.dataTransfer.setData('sourceType', 'leave');
            } else {
                e.dataTransfer.setData('source', 'pool');
                e.dataTransfer.setData('sourceType', 'pool');
            }
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            const wfhZone = e.target.closest('.wfh-zone');
            const leaveZone = e.target.closest('.leave-zone');
            if (wfhZone) {
                wfhZone.closest('.day-column').classList.add('drag-over');
            } else if (leaveZone) {
                leaveZone.closest('.day-column').classList.add('drag-over-leave');
            }
        }

        function handleDragLeave(e) {
            const wfhZone = e.target.closest('.wfh-zone');
            const leaveZone = e.target.closest('.leave-zone');
            if (wfhZone && !wfhZone.contains(e.relatedTarget)) {
                wfhZone.closest('.day-column').classList.remove('drag-over');
            }
            if (leaveZone && !leaveZone.contains(e.relatedTarget)) {
                leaveZone.closest('.day-column').classList.remove('drag-over-leave');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            const name = e.dataTransfer.getData('text/plain');
            const sourceDay = e.dataTransfer.getData('source');
            const sourceType = e.dataTransfer.getData('sourceType');
            const targetZone = e.target.closest('.wfh-zone');

            document.querySelectorAll('.day-column').forEach(col => {
                col.classList.remove('drag-over');
                col.classList.remove('drag-over-leave');
            });

            if (!targetZone) return;

            const targetDay = targetZone.dataset.day;
            const { wfh: wfhSchedule, leave: leaveSchedule } = getCurrentSchedules();

            if (!wfhSchedule[name]) {
                wfhSchedule[name] = [];
            }
            if (!leaveSchedule[name]) {
                leaveSchedule[name] = [];
            }

            // Remove from source if coming from another zone
            if (sourceType === 'wfh' && sourceDay !== targetDay) {
                wfhSchedule[name] = wfhSchedule[name].filter(d => d !== sourceDay);
            } else if (sourceType === 'leave') {
                leaveSchedule[name] = leaveSchedule[name].filter(d => d !== sourceDay);
            }

            // Check if already WFH on this day
            if (wfhSchedule[name].includes(targetDay)) {
                return;
            }

            // If on leave this day, remove from leave first
            if (leaveSchedule[name].includes(targetDay)) {
                leaveSchedule[name] = leaveSchedule[name].filter(d => d !== targetDay);
            }

            // Check if already has 2 WFH days (only if not moving from another WFH day)
            if (wfhSchedule[name].length >= 2 && sourceType !== 'wfh') {
                showError(`${name} already has 2 WFH days assigned!`);
                return;
            }

            // Add to target day
            wfhSchedule[name].push(targetDay);

            saveState();
            render();
        }

        function handleLeaveDrop(e) {
            e.preventDefault();
            const name = e.dataTransfer.getData('text/plain');
            const sourceDay = e.dataTransfer.getData('source');
            const sourceType = e.dataTransfer.getData('sourceType');
            const targetZone = e.target.closest('.leave-zone');

            document.querySelectorAll('.day-column').forEach(col => {
                col.classList.remove('drag-over');
                col.classList.remove('drag-over-leave');
            });

            if (!targetZone) return;

            const targetDay = targetZone.dataset.day;
            const { wfh: wfhSchedule, leave: leaveSchedule } = getCurrentSchedules();

            if (!leaveSchedule[name]) {
                leaveSchedule[name] = [];
            }
            if (!wfhSchedule[name]) {
                wfhSchedule[name] = [];
            }

            // Remove from source if coming from another zone
            if (sourceType === 'leave' && sourceDay !== targetDay) {
                leaveSchedule[name] = leaveSchedule[name].filter(d => d !== sourceDay);
            } else if (sourceType === 'wfh') {
                wfhSchedule[name] = wfhSchedule[name].filter(d => d !== sourceDay);
            }

            // Check if already on leave this day
            if (leaveSchedule[name].includes(targetDay)) {
                return;
            }

            // If WFH this day, remove from WFH (leave takes priority)
            if (wfhSchedule[name].includes(targetDay)) {
                wfhSchedule[name] = wfhSchedule[name].filter(d => d !== targetDay);
            }

            // Add to leave
            leaveSchedule[name].push(targetDay);

            saveState();
            render();
        }

        function handlePoolDrop(e) {
            e.preventDefault();
            const name = e.dataTransfer.getData('text/plain');
            const sourceDay = e.dataTransfer.getData('source');
            const sourceType = e.dataTransfer.getData('sourceType');
            const { wfh: wfhSchedule, leave: leaveSchedule } = getCurrentSchedules();

            if (sourceType === 'wfh') {
                wfhSchedule[name] = wfhSchedule[name].filter(d => d !== sourceDay);
                saveState();
                render();
            } else if (sourceType === 'leave') {
                leaveSchedule[name] = leaveSchedule[name].filter(d => d !== sourceDay);
                saveState();
                render();
            }
        }

        function getOfficeCount(day) {
            const { wfh: wfhSchedule, leave: leaveSchedule } = getCurrentSchedules();
            let notInOfficeCount = 0;
            let onLeaveCount = 0;

            // Count people on leave
            for (const person in leaveSchedule) {
                if (leaveSchedule[person].includes(day)) {
                    notInOfficeCount++;
                    onLeaveCount++;
                }
            }

            // Count people WFH (but not on leave)
            for (const person in wfhSchedule) {
                if (wfhSchedule[person].includes(day) &&
                    (!leaveSchedule[person] || !leaveSchedule[person].includes(day))) {
                    notInOfficeCount++;
                }
            }

            return {
                inOffice: people.length - notInOfficeCount,
                onLeave: onLeaveCount
            };
        }

        function renderDashboard() {
            const dashboard = document.getElementById('dashboard');
            const counts = days.map(day => ({ day, ...getOfficeCount(day) }));
            const maxCount = Math.max(...counts.map(c => c.inOffice));
            const minCount = Math.min(...counts.map(c => c.inOffice));

            dashboard.innerHTML = counts.map(({ day, inOffice, onLeave }) => {
                let className = 'stat-card';
                if (inOffice === maxCount && maxCount !== minCount) className += ' best';
                if (inOffice === minCount && maxCount !== minCount) className += ' worst';

                return `
                    <div class="${className}">
                        <div class="stat-day">${day}</div>
                        <div class="stat-count">${inOffice}</div>
                        <div class="stat-label">in office${onLeave > 0 ? ` (${onLeave} on leave)` : ''}</div>
                    </div>
                `;
            }).join('');
        }

        function renderWeekSelector() {
            const selector = document.getElementById('week-selector');
            selector.innerHTML = [0, 1].map(weekOffset => {
                const label = weekOffset === 0 ? 'This Week' : 'Next Week';
                const dates = getWeekDateRange(weekOffset);
                const activeClass = selectedWeek === weekOffset ? 'active' : '';

                return `
                    <button class="week-btn ${activeClass}" data-week="${weekOffset}">
                        <span class="week-btn-label">${label}</span>
                        <span class="week-btn-dates">${dates}</span>
                    </button>
                `;
            }).join('');

            // Add click handlers
            selector.querySelectorAll('.week-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    selectedWeek = parseInt(btn.dataset.week);
                    render();
                });
            });
        }

        function render() {
            renderWeekSelector();
            renderDashboard();

            const { wfh: wfhSchedule, leave: leaveSchedule } = getCurrentSchedules();

            // Render people pool
            const pool = document.getElementById('people-pool');
            pool.innerHTML = '';

            people.forEach(name => {
                pool.appendChild(createPersonElement(name));
            });

            pool.addEventListener('dragover', (e) => e.preventDefault());
            pool.addEventListener('drop', handlePoolDrop);

            // Render schedule
            const schedule = document.getElementById('schedule');
            schedule.innerHTML = '';

            days.forEach(day => {
                const { inOffice, onLeave } = getOfficeCount(day);
                const counts = days.map(d => getOfficeCount(d).inOffice);
                const maxCount = Math.max(...counts);
                const minCount = Math.min(...counts);

                let countClass = '';
                if (inOffice === maxCount && maxCount !== minCount) countClass = 'high';
                if (inOffice === minCount && maxCount !== minCount) countClass = 'low';

                const column = document.createElement('div');
                column.className = 'day-column';

                // Get people on leave this day
                const leavePeople = people.filter(name =>
                    leaveSchedule[name] && leaveSchedule[name].includes(day)
                );

                // Get people WFH on this day (but not on leave)
                const wfhPeople = people.filter(name =>
                    wfhSchedule[name] && wfhSchedule[name].includes(day) &&
                    (!leaveSchedule[name] || !leaveSchedule[name].includes(day))
                );

                // Get people in office on this day (not WFH and not on leave)
                const officePeople = people.filter(name =>
                    (!wfhSchedule[name] || !wfhSchedule[name].includes(day)) &&
                    (!leaveSchedule[name] || !leaveSchedule[name].includes(day))
                );

                column.innerHTML = `
                    <div class="day-header">
                        <div class="day-name">${day}</div>
                        <div class="day-count ${countClass}">
                            üè¢ ${inOffice} in office
                        </div>
                    </div>
                    <div class="wfh-zone" data-day="${day}">
                        <h3>PROJECT R (${wfhPeople.length})</h3>
                    </div>
                    <div class="in-office-list">
                        <h3>In Office (${officePeople.length})</h3>
                        ${officePeople.map(name => `
                            <div class="office-person">${name}</div>
                        `).join('')}
                    </div>
                    <div class="leave-zone" data-day="${day}">
                        <h3>‚úàÔ∏è On Leave (${leavePeople.length})</h3>
                    </div>
                `;

                const wfhZone = column.querySelector('.wfh-zone');
                wfhPeople.forEach(name => {
                    wfhZone.appendChild(createPersonElement(name, true));
                });

                wfhZone.addEventListener('dragover', handleDragOver);
                wfhZone.addEventListener('dragleave', handleDragLeave);
                wfhZone.addEventListener('drop', handleDrop);

                const leaveZone = column.querySelector('.leave-zone');
                leavePeople.forEach(name => {
                    leaveZone.appendChild(createPersonElement(name, true));
                });

                leaveZone.addEventListener('dragover', handleDragOver);
                leaveZone.addEventListener('dragleave', handleDragLeave);
                leaveZone.addEventListener('drop', handleLeaveDrop);

                schedule.appendChild(column);
            });
        }

        function saveState() {
            localStorage.setItem('allSchedules', JSON.stringify(allSchedules));
        }

        function loadState() {
            const saved = localStorage.getItem('allSchedules');
            if (saved) {
                allSchedules = JSON.parse(saved);
            }

            // Migration: if old format exists, migrate it to new format
            const oldWfh = localStorage.getItem('wfhSchedule');
            const oldLeave = localStorage.getItem('leaveSchedule');
            if (oldWfh || oldLeave) {
                const thisWeekKey = getWeekKey(0);
                if (!allSchedules[thisWeekKey]) {
                    allSchedules[thisWeekKey] = {
                        wfh: oldWfh ? JSON.parse(oldWfh) : {},
                        leave: oldLeave ? JSON.parse(oldLeave) : {}
                    };
                }
                // Clean up old storage
                localStorage.removeItem('wfhSchedule');
                localStorage.removeItem('leaveSchedule');
                saveState();
            }
        }

        // Initialize
        loadState();
        render();
    </script>
</body>
</html>
